1.TARİHE GÖRE SIRALAMA(AY)

SELECT 
	DATEPART(MONTH,O.DATE_) AS AY,
	DATEPART(YEAR,O.DATE_) AS AY,
	SUM(OO.LINETOTAL) AS TOPLAMSIPARISTUTARI,
	SUM(OO.AMOUNT) AS TOPLAMSIPARISMIKTARI,
	COUNT(OO.ID) AS TOPLAMSIPARISSAYISI

FROM ORDERS O
	INNER JOIN USERS U ON U.ID = O.USERID
	INNER JOIN ADDRESS A ON A.ID = O.ADDRESSID
	INNER JOIN CITIES C ON C.ID =A.CITYID
	INNER JOIN TOWNS T ON T.ID = A.TOWNID
	INNER JOIN DISTRICTS D ON D.ID = A.DISTRICTID
	INNER JOIN PAYMENTS P ON P.ORDERID = O.ID
	INNER JOIN INVOICES I ON I.ORDERID = O.ID
	INNER JOIN ORDERDETAILS OO ON OO.ORDERID = O.ID
	INNER JOIN ITEMS ITM ON ITM.ID = OO.ITEMID

GROUP BY DATEPART(MONTH,O.DATE_),DATEPART(YEAR,O.DATE_)
ORDER BY DATEPART(MONTH,O.DATE_),DATEPART(YEAR,O.DATE_)

-----------------------------------------------------------------------------------------------

2. ÖDEME TÜRÜNE GÖRE DAĞILIM

SELECT 
	DATEPART(YEAR,DATE_) AS YIL,
	DATEPART(MONTH,DATE_) AS AY,
CASE
	WHEN PAYMENTTYPE=1 THEN 'KREDİ KARTI'
	WHEN PAYMENTTYPE=2 THEN 'BANKA HAVALE'
END AS ODEMETURU,
	SUM(PAYMENTTOTAL) AS TOPLAMTUTAR

FROM 
	PAYMENTS 
GROUP BY DATEPART(MONTH,DATE_),PAYMENTTYPE,DATEPART(YEAR,DATE_)
ORDER BY DATEPART(YEAR,DATE_),DATEPART(MONTH,DATE_)

------------------------------------------------------------------------------------------------

3. ORTALAMA TESLİMAT SÜRESİ

SELECT
	MIN(DATEDIFF(HOUR,O.DATE_,I.DATE_)) AS MINTESLIMATSURESI,
	MAX(DATEDIFF(HOUR,O.DATE_,I.DATE_)) AS MAXTESLIMATSURESI,
	AVG(DATEDIFF(HOUR,O.DATE_,I.DATE_)) AS ORTALAMATESLIMATSURESI
	
FROM ORDERS O
	INNER JOIN USERS U ON U.ID = O.USERID
	INNER JOIN ADDRESS A ON A.ID = O.ADDRESSID
	INNER JOIN CITIES C ON C.ID =A.CITYID
	INNER JOIN TOWNS T ON T.ID = A.TOWNID
	INNER JOIN DISTRICTS D ON D.ID = A.DISTRICTID
	INNER JOIN PAYMENTS P ON P.ORDERID = O.ID
	INNER JOIN INVOICES I ON I.ORDERID = O.ID

------------------------------------------------------------------------------------------------

4.TESLIMAT SURESI DETAY

SELECT
	U.ID,
	U.NAMESURNAME,
	SUM(O.TOTALPRICE) AS TOPLAMSIPARISTUTARI,
	AVG(DATEDIFF(HOUR,O.DATE_,I.DATE_)) AS ORTALAMATESLIMATSURESI,
	COUNT(O.ID) AS SIPARISSAYISI
	
FROM ORDERS O
	INNER JOIN USERS U ON U.ID = O.USERID
	INNER JOIN ADDRESS A ON A.ID = O.ADDRESSID
	INNER JOIN CITIES C ON C.ID =A.CITYID
	INNER JOIN TOWNS T ON T.ID = A.TOWNID
	INNER JOIN DISTRICTS D ON D.ID = A.DISTRICTID
	INNER JOIN PAYMENTS P ON P.ORDERID = O.ID
	INNER JOIN INVOICES I ON I.ORDERID = O.ID
GROUP BY U.ID,U.NAMESURNAME
HAVING AVG(DATEDIFF(HOUR,O.DATE_,I.DATE_))>27
ORDER BY 3 DESC